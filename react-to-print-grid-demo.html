<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid-Based Screenplay Layout Demo</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans Thai', sans-serif;
        }
        
        /* Print Utilities */
        @media print {
            .screen-only { 
                display: none !important; 
            }
            
            .print-only { 
                display: block !important; 
            }

            @page {
                size: A4;
                margin: 0.75in;
            }

            .page-break-after {
                break-after: page;
                page-break-after: always;
            }

            /* Cover Page Styles - Perfect Centering */
            .cover-page {
                height: 100vh; /* Full viewport height for perfect centering */
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                text-align: center;
                position: relative;
            }

            .cover-poster {
                max-height: 40vh;
                width: auto;
                object-fit: contain;
                margin-bottom: 2rem;
            }

            .cover-title {
                font-size: 2.5rem;
                font-weight: bold;
                margin-bottom: 2rem;
                font-family: "Courier Prime", "Courier New", Courier, monospace;
                text-transform: uppercase;
            }

            .cover-logline {
                font-size: 1.125rem;
                margin-bottom: 3rem;
                max-width: 600px;
                line-height: 1.4;
                font-family: "Courier Prime", "Courier New", Courier, monospace;
            }

            .cover-credits {
                font-size: 1rem;
                line-height: 1.5;
                font-family: "Courier Prime", "Courier New", Courier, monospace;
                position: absolute;
                bottom: 2rem;
                left: 50%;
                transform: translateX(-50%);
            }

            .cover-credits > div {
                margin-bottom: 0.5rem;
            }

            /* Script Body Styles */
            .script {
                font-family: "Courier Prime", "Courier New", Courier, monospace;
                line-height: 1.35;
                font-size: 12pt;
                color: black !important;
            }

            /* Grid Layout for Script Rows */
            .script-row {
                display: grid;
                grid-template-columns: 1fr max-content;
                align-items: start;
                column-gap: 0.5rem;
                margin-bottom: 1em;
                page-break-inside: avoid;
            }

            .script-row--single {
                display: grid;
                grid-template-columns: 1fr;
                margin-bottom: 1em;
                page-break-inside: avoid;
            }

            /* Right Rail Alignment */
            .rail-right {
                text-align: right;
                white-space: nowrap;
                font-family: "Courier Prime", "Courier New", Courier, monospace;
                font-weight: normal;
                text-transform: none;
            }

            /* Script Content Styling - Hollywood Standard Format */
            .scene-number {
                margin-left: -0.5in; /* Slightly outdented */
                margin-bottom: 0.5em;
                font-weight: bold;
                font-family: "Courier Prime", "Courier New", Courier, monospace;
            }

            .scene-heading, .action, .text, .shot {
                margin-left: 0;
                margin-bottom: 0.5em;
                font-family: "Courier Prime", "Courier New", Courier, monospace;
            }

            .scene-heading {
                font-weight: bold;
                text-transform: uppercase;
                margin-top: 1em;
            }

            .action {
                text-align: justify;
            }

            .character {
                margin-left: 3.7in; /* Standard character indent */
                font-weight: bold;
                text-transform: uppercase;
                margin-top: 1em;
                margin-bottom: 0.25em;
                font-family: "Courier Prime", "Courier New", Courier, monospace;
            }

            .dialogue {
                margin-left: 2.5in; /* Standard dialogue indent */
                margin-right: 2.0in; /* Right margin for dialogue */
                margin-bottom: 0.5em;
                font-family: "Courier Prime", "Courier New", Courier, monospace;
            }

            .parenthetical {
                margin-left: 3.1in; /* Standard parenthetical indent */
                margin-right: 2.5in;
                font-style: italic;
                margin-bottom: 0.25em;
                font-family: "Courier Prime", "Courier New", Courier, monospace;
            }

            .text {
                text-align: justify;
            }

            .shot {
                font-weight: bold;
                text-transform: uppercase;
            }

            /* Prevent orphans and widows */
            .script-row,
            .script-row--single {
                orphans: 2;
                widows: 2;
            }
        }

        /* Screen Display Styles (non-print) */
        .print-only {
            display: none;
        }

        .screen-only {
            display: block;
        }

        /* Grid Layout for Screen Display */
        .script-row {
            display: grid;
            grid-template-columns: 1fr max-content;
            align-items: start;
            column-gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .script-row--single {
            display: grid;
            grid-template-columns: 1fr;
            margin-bottom: 1rem;
        }

        .rail-right {
            text-align: right;
            white-space: nowrap;
            font-size: 12px;
            color: #666;
            font-weight: normal;
        }

        /* Script Content Styling for Screen */
        .script {
            font-family: 'Noto Sans Thai', sans-serif;
            line-height: 1.5;
        }

        .scene-heading {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .action {
            margin-bottom: 0.5rem;
        }

        .character {
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 1rem;
            margin-bottom: 0.25rem;
        }

        .dialogue {
            margin-bottom: 0.5rem;
        }

        .parenthetical {
            font-style: italic;
            margin-bottom: 0.25rem;
        }

        .text {
            margin-bottom: 0.5rem;
        }

        .shot {
            font-weight: bold;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef } = React;

        // Sample screenplay data
        const sampleBlocks = [
            {
                id: '1',
                type: 'scene-heading',
                content: 'EXT. ชายทะเล บางแสน - DAWN'
            },
            {
                id: '2',
                type: 'action',
                content: 'คำบรรยายเหตุการณ์ที่เกิดขึ้นในฉากนี้ เป็นการบรรยายที่ยาวพอสมควรเพื่อทดสอบการจัดรูปแบบ'
            },
            {
                id: '3',
                type: 'character',
                content: 'ปูเป้'
            },
            {
                id: '4',
                type: 'dialogue',
                content: 'ประโยคบทพูดที่ยาวพอสมควรเพื่อทดสอบการจัดรูปแบบและการแสดงหมายเลขบทพูด'
            },
            {
                id: '5',
                type: 'character',
                content: 'เอ๋'
            },
            {
                id: '6',
                type: 'parenthetical',
                content: 'ด้วยความประหลาดใจ'
            },
            {
                id: '7',
                type: 'dialogue',
                content: 'บทพูดตอบกลับที่แสดงอารมณ์ความรู้สึก'
            },
            {
                id: '8',
                type: 'transition',
                content: 'CUT TO:'
            },
            {
                id: '9',
                type: 'scene-heading',
                content: 'INT. ห้องนั่งเล่น - DAY'
            },
            {
                id: '10',
                type: 'action',
                content: 'Write your scene description here.'
            },
            {
                id: '11',
                type: 'character',
                content: 'JOHN'
            },
            {
                id: '12',
                type: 'dialogue',
                content: 'This is a sample dialogue to test the English text formatting.'
            },
            {
                id: '13',
                type: 'transition',
                content: 'FADE OUT:'
            }
        ];

        const PrintableScreenplay = React.forwardRef(({ blocks, title, author, contact, director, writer, runtime, school, logline, posterUrl }, ref) => {
            let sceneNumber = 1;
            let dialogNumber = 1;

            const renderScriptBlock = (block, index) => {
                let content = block.content;
                let rightRailContent = '';
                let hasRightRail = false;
                let sceneNumberElement = null;

                // Handle scene headings with separate scene number
                if (block.type === 'scene-heading') {
                    sceneNumberElement = (
                        <div className="script-row--single">
                            <div className="scene-number">{sceneNumber}.</div>
                        </div>
                    );
                    sceneNumber++;
                }

                // Add dialog numbers to dialogue blocks
                if (block.type === 'dialogue') {
                    rightRailContent = `${dialogNumber}`;
                    hasRightRail = true;
                    dialogNumber++;
                }

                // Transitions go in the right rail
                if (block.type === 'transition') {
                    rightRailContent = content;
                    content = '';
                    hasRightRail = true;
                }

                // Determine grid layout class
                const gridClass = hasRightRail ? 'script-row' : 'script-row--single';

                return (
                    <React.Fragment key={block.id || index}>
                        {/* Scene number (if applicable) */}
                        {sceneNumberElement}
                        
                        {/* Main content block */}
                        <div className={`${gridClass} block-${block.type}`} data-block-type={block.type}>
                            {/* Left column - main content */}
                            <div className="script-content">
                                {content && (
                                    <>
                                        {block.type === 'scene-heading' && (
                                            <div className="scene-heading">{content}</div>
                                        )}
                                        {block.type === 'action' && (
                                            <div className="action">{content}</div>
                                        )}
                                        {block.type === 'character' && (
                                            <div className="character">{content}</div>
                                        )}
                                        {block.type === 'dialogue' && (
                                            <div className="dialogue">{content}</div>
                                        )}
                                        {block.type === 'parenthetical' && (
                                            <div className="parenthetical">({content})</div>
                                        )}
                                        {block.type === 'text' && (
                                            <div className="text">{content}</div>
                                        )}
                                        {block.type === 'shot' && (
                                            <div className="shot">{content}</div>
                                        )}
                                    </>
                                )}
                            </div>
                            
                            {/* Right column - rail content (transitions, dialog numbers) */}
                            {hasRightRail && (
                                <div className="rail-right">
                                    {rightRailContent}
                                </div>
                            )}
                        </div>
                    </React.Fragment>
                );
            };

            return (
                <div ref={ref} className="printable-screenplay">
                    {/* COVER PAGE - visible only on print */}
                    <div className="print-only cover-page">
                        {posterUrl && (
                            <img src={posterUrl} alt="Poster" className="cover-poster" />
                        )}
                        <h1 className="cover-title">{title.toUpperCase()}</h1>
                        {logline && <p className="cover-logline">{logline}</p>}
                        <div className="cover-credits">
                            {director && <div>Director: {director}</div>}
                            {writer && <div>Writer: {writer}</div>}
                            {author && <div>Author: {author}</div>}
                            {runtime && <div>Runtime: {runtime}</div>}
                            {school && <div>School: {school}</div>}
                            {contact && <div>Contact: {contact}</div>}
                        </div>
                    </div>

                    {/* Force page break after cover */}
                    <div className="print-only page-break-after"></div>

                    {/* SCRIPT BODY */}
                    <div className="script">
                        {blocks.map((block, index) => renderScriptBlock(block, index))}
                    </div>
                </div>
            );
        });

        const GridLayoutDemo = () => {
            const printRef = useRef(null);

            const handlePrint = () => {
                window.print();
            };

            return (
                <div className="min-h-screen bg-gray-50 p-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-8">
                            <h1 className="text-3xl font-bold text-gray-900 mb-4">
                                Grid-Based Screenplay Layout Demo
                            </h1>
                            <p className="text-gray-600 mb-6">
                                This demo showcases the new grid-based layout system with:
                            </p>
                            <ul className="list-disc list-inside text-gray-600 mb-6 space-y-2">
                                <li>Two-column grid layout (content + right rail)</li>
                                <li>Transitions flush to right margin</li>
                                <li>Dialog numbers flush to right margin</li>
                                <li>Optional cover page with metadata</li>
                                <li>Proper page breaks and print formatting</li>
                                <li>Thai and English text support</li>
                            </ul>

                            <button 
                                onClick={handlePrint}
                                className="screen-only bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-200 shadow-md hover:shadow-lg"
                            >
                                🖨️ Print / Save as PDF
                            </button>
                        </div>

                        {/* Print Preview Area */}
                        <div className="bg-white rounded-lg shadow-lg p-6">
                            <h2 className="text-xl font-semibold text-gray-900 mb-4">
                                Print Preview
                            </h2>
                            <div className="border border-gray-200 rounded-lg p-4 bg-white">
                                <PrintableScreenplay
                                    ref={printRef}
                                    blocks={sampleBlocks}
                                    title="Sample Screenplay"
                                    author="Demo Author"
                                    contact="demo@example.com"
                                    director="Demo Director"
                                    writer="Demo Writer"
                                    runtime="90 minutes"
                                    school="Film School"
                                    logline="A demonstration of the new grid-based screenplay layout system with proper formatting and professional presentation."
                                />
                            </div>
                        </div>

                        {/* Layout Explanation */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mt-8">
                            <h2 className="text-xl font-semibold text-gray-900 mb-4">
                                Layout Features
                            </h2>
                            <div className="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h3 className="font-semibold text-gray-900 mb-2">
                                        Grid System
                                    </h3>
                                    <ul className="text-sm text-gray-600 space-y-1">
                                        <li>• Two-column grid: content + right rail</li>
                                        <li>• Single-column for content-only blocks</li>
                                        <li>• Proper alignment and spacing</li>
                                        <li>• No overlap or clipping issues</li>
                                    </ul>
                                </div>
                                <div>
                                    <h3 className="font-semibold text-gray-900 mb-2">
                                        Right Rail Elements
                                    </h3>
                                    <ul className="text-sm text-gray-600 space-y-1">
                                        <li>• Transitions (CUT TO:, FADE OUT:)</li>
                                        <li>• Dialog numbers (1, 2, 3...)</li>
                                        <li>• Flush to right margin</li>
                                        <li>• Professional formatting</li>
                                    </ul>
                                </div>
                                <div>
                                    <h3 className="font-semibold text-gray-900 mb-2">
                                        Cover Page
                                    </h3>
                                    <ul className="text-sm text-gray-600 space-y-1">
                                        <li>• Optional poster image</li>
                                        <li>• Title and logline</li>
                                        <li>• Credits and metadata</li>
                                        <li>• Automatic page break</li>
                                    </ul>
                                </div>
                                <div>
                                    <h3 className="font-semibold text-gray-900 mb-2">
                                        Print Features
                                    </h3>
                                    <ul className="text-sm text-gray-600 space-y-1">
                                        <li>• A4 page size with proper margins</li>
                                        <li>• Courier Prime monospace font</li>
                                        <li>• Page break controls</li>
                                        <li>• Screen/print visibility controls</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<GridLayoutDemo />, document.getElementById('root'));
    </script>
</body>
</html>
